branches:
  only:
  - master
addons:
  ssh_known_hosts:
  - bitbucket.org
cache:
  bundler: true
  cocoapods: true
  yarn: true
  directories:
  - node_modules
  - vendor/bundle
  - "$HOME/.nvm/versions/"
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
  - "$HOME/.npm"
before_install:
- chmod -R +x travis-ci/
- chmod -R +x scripts/
install:
- nvm install && nvm use
- npm install -g "npm@$(jq -r '.engines.npm' package.json)"
- npm ci
after_script:
- npm run test:coverage
matrix:
  include:
  - os: linux
    language: android
    jdk: oraclejdk8
    android:
      components:
      - build-tools-27.0.3
      - android-27
    script:
    - "./android/gradlew assembleRelease -p android/"
    - npm run ci:check
  - os: osx
    osx_image: xcode9.3
    podfile: ios/Podfile
    script:
    - bundle exec fastlane ios test
    - npm run ci:check
